<!doctype html>
<html lang="pt-br">
<head>
  <!-- Google tag (gtag.js) -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-H5DTVXXB59"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-H5DTVXXB59');
  </script>

  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Achadinhos Oficial</title>
  <meta name="theme-color" content="#0f172a" />

<style>
:root{
  /* Tema claro (profissional) */
  --bg:#f6f7fb;
  --card:#ffffff;
  --soft:#f1f5f9;

  --text:#0f172a;
  --muted:#64748b;

  --brand:#16a34a;
  --accent:#f59e0b;
  --danger:#dc2626;

  --border:rgba(15,23,42,.10);
  --shadow: 0 12px 28px rgba(2,6,23,.10);
  --radius:16px;

  --yellow:#ffd000;
  --yellow2:#ffb800;
  --yellowText:#1a1400;
}

*{box-sizing:border-box}
body{
  margin:0;
  font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
  background:
    radial-gradient(1000px 600px at 20% 0%, rgba(34,197,94,.12), transparent 60%),
    radial-gradient(800px 500px at 80% 10%, rgba(245,158,11,.10), transparent 55%),
    var(--bg);
  color:var(--text);
  overflow-x:hidden;
}
a{color:inherit;text-decoration:none}
.wrap{max-width:1100px;margin:0 auto;padding:16px}

/* BARRA AMARELA */
.topbar{
  background: linear-gradient(90deg, var(--yellow), var(--yellow2));
  color:var(--yellowText);
  border-bottom:1px solid rgba(0,0,0,.12);
  position:sticky;
  top:0;
  z-index:80;
}
.topbar .wrap{
  /* espessura dobrada */
  padding:28px 16px;
  display:flex;
  align-items:center;
  justify-content:space-between;
  gap:12px;
}
.topbrand{
  display:flex;align-items:center;gap:12px;
  font-weight:1000;
  letter-spacing:.2px;
  min-width:0;
}
.toplogo{
  width:64px;height:64px;
  border-radius:18px;
  background:#111;
  display:flex;align-items:center;justify-content:center;
  overflow:hidden;
  flex:0 0 auto;
  box-shadow: 0 12px 26px rgba(0,0,0,.20);
}
.toplogo img{width:100%;height:100%;object-fit:contain}
.toptext{min-width:0;display:flex;flex-direction:column;gap:4px}
.topname{
  font-size:24px;
  line-height:1.1;
  white-space:nowrap;
  overflow:hidden;
  text-overflow:ellipsis;
}
.toptag{
  font-size:15px;
  opacity:.95;
  font-weight:900;
  white-space:nowrap;
  overflow:hidden;
  text-overflow:ellipsis;
  max-width:60vw;
}
.topright{
  display:flex;gap:10px;align-items:center;flex:0 0 auto;
  font-weight:1000;
  font-size:13px;
  background: rgba(0,0,0,.10);
  border:1px solid rgba(0,0,0,.12);
  border-radius:999px;
  padding:10px 12px;
  white-space:nowrap;
  cursor:pointer;
  user-select:none;
}
.topright:active{transform: translateY(1px)}

@media (max-width: 520px){
  .topbar .wrap{padding:22px 14px}
  .toplogo{width:50px;height:50px}
  .topname{font-size:18px}
  /* mostra a copy no mobile */
  .toptag{
    display:block !important;
    font-size:13px !important;
    font-weight:900 !important;
    opacity:1 !important;
    white-space:normal !important;
    overflow:visible !important;
    text-overflow:unset !important;
    line-height:1.2 !important;
    max-width:75vw !important;
    color:#1a1400 !important;
  }
}

/* Header (remove o "segundo Achadinhos") */
header{
  position:sticky;
  top:90px;
  z-index:60;
  background: rgba(255,255,255,.92);
  backdrop-filter: blur(10px);
  border-bottom:1px solid var(--border);
}
@media (max-width: 520px){
  header{top:86px}
}

/* remove a marca duplicada abaixo da faixa amarela */
header .brand{display:none !important;}

.headbar{
  display:flex;gap:12px;align-items:center;justify-content:space-between;
  padding:12px 0;
  flex-wrap:wrap;
}
.sub{
  font-size:12px;
  color:var(--muted);
  margin-top:2px;
  font-weight:600;
}
.status{
  display:flex;align-items:center;gap:10px;
  padding:10px 12px;
  border:1px solid var(--border);
  border-radius:999px;
  background: rgba(255,255,255,.75);
  font-size:12px;
  color:var(--muted);
  white-space:nowrap;
  max-width: 100%;
  overflow:hidden;
  text-overflow: ellipsis;
}
.dot{width:9px;height:9px;border-radius:999px;background:var(--accent);box-shadow: 0 0 0 4px rgba(245,158,11,.12)}
.status b{color:var(--text)}
.pill{
  padding:8px 10px;border-radius:999px;
  background: rgba(255,208,0,.20);
  border:1px solid rgba(255,184,0,.35);
  font-size:12px;font-weight:1000;color:#1a1400;
  white-space:nowrap;
}

/* Corrige cor do contador de ofertas */
#countPill{
  color:#1a1400 !important;
  background: rgba(255,208,0,.20) !important;
  border: 1px solid rgba(255,184,0,.35) !important;
  font-weight:1000 !important;
}

/* Hero */
.hero{
  margin-top:16px;
  background: rgba(255,255,255,.92);
  border:1px solid var(--border);
  border-radius: var(--radius);
  box-shadow: var(--shadow);
  overflow:hidden;
  position:relative;
}
.hero:before{
  content:"";
  position:absolute; inset:-2px;
  background:
    radial-gradient(620px 240px at 18% 0%, rgba(255,208,0,.30), transparent 60%),
    radial-gradient(520px 260px at 78% 0%, rgba(34,197,94,.18), transparent 55%);
  pointer-events:none;
}
.hero-inner{
  position:relative;
  padding:18px;
  display:grid;
  grid-template-columns: 1.3fr .7fr;
  gap:14px;
  align-items:start;
}
@media (max-width: 860px){
  .hero-inner{grid-template-columns:1fr}
}
.hero h1{margin:0;font-size:24px;line-height:1.2;color:var(--text)}
.hero p{margin:8px 0 0;color:var(--muted);font-weight:700}
.hero .ctaRow{display:flex;gap:10px;flex-wrap:wrap;margin-top:12px}

/* Bot√µes */
.btn{
  display:inline-flex;align-items:center;gap:10px;
  padding:12px 14px;border-radius:14px;
  border:1px solid rgba(15,23,42,.14);
  background: rgba(255,255,255,.92);
  font-weight:900;
  cursor:pointer;
  transition: transform .08s ease;
  user-select:none;
  color:var(--text);
  box-shadow: 0 10px 20px rgba(2,6,23,.06);
}
.btn:active{transform: translateY(1px)}
.btnPrimary{
  background: linear-gradient(135deg, rgba(22,163,74,.98), rgba(22,163,74,.78));
  color:#052014;border:none;
  box-shadow: 0 14px 28px rgba(34,197,94,.18);
}

.kpi{display:grid;gap:10px;}
.kpiCard{
  border:1px solid var(--border);
  background: rgba(255,255,255,.92);
  border-radius:14px;
  padding:12px;
}
.kpiCard b{font-size:16px;color:var(--text)}
.kpiCard span{display:block;color:var(--muted);font-size:12px;font-weight:800;margin-top:2px}

/* V√çDEO (box com contraste amarelo + branco) */
.videoWrap{
  margin:12px auto 0;
  border:2px solid #ffd000;
  background: linear-gradient(180deg, #ffd000 0%, #ffedb3 35%, #ffffff 100%) !important;
  border-radius:14px;
  overflow:hidden;
  max-width: 520px;
  box-shadow: 0 12px 28px rgba(0,0,0,.12);
  padding:10px;
}
@media (max-width: 860px){
  .videoWrap{max-width:100%}
}
.videoTop{
  display:flex;align-items:center;justify-content:space-between;gap:10px;
  padding:10px 12px;
  border-bottom:1px solid rgba(0,0,0,.15);
  flex-wrap:wrap;
  background: linear-gradient(90deg, #ffb800, #ffd000) !important;
  color:#1a1400 !important;
  border-radius:10px 10px 0 0;
}
.videoTop b{font-size:13px;color:#1a1400 !important}
.videoTop .mini{font-size:12px;color:#1a1400 !important;font-weight:900}
.btnTiny{
  padding:10px 12px;border-radius:12px;
  border:none;
  background:#111 !important;
  font-weight:1000;
  cursor:pointer;
  color:#fff !important;
  box-shadow: 0 4px 10px rgba(0,0,0,.25);
}
.videoFrame{
  aspect-ratio: 16 / 9;
  background:#000;
  border-radius:0 0 10px 10px;
  overflow:hidden;
  box-shadow: inset 0 0 0 2px rgba(0,0,0,.35);
}
video{
  width:100%;
  height:100%;
  object-fit:cover;
  display:block;
  background:#000;
}

/* OFERTA DO MINUTO */
.spot{
  margin-top:14px;
  border:1px solid rgba(245,158,11,.22);
  background: rgba(255,255,255,.92);
  border-radius: var(--radius);
  box-shadow: 0 12px 24px rgba(0,0,0,.12);
  overflow:hidden;
  display:grid;
  grid-template-columns: 1fr 1.25fr;
  gap:0;
}
@media (max-width: 860px){
  .spot{grid-template-columns:1fr}
}
.spotImg{
  background: rgba(15,23,42,.04);
  border-right:1px solid rgba(15,23,42,.08);
  min-height: 220px;
  display:flex;align-items:center;justify-content:center;
  padding:10px;
}
@media (max-width: 860px){
  .spotImg{border-right:none;border-bottom:1px solid rgba(15,23,42,.08)}
}
.spotImg img{
  width:100%;
  height:100%;
  max-height: 260px;
  object-fit:contain;
  border-radius: 14px;
  background: #fff;
  border:1px solid rgba(15,23,42,.10);
}
.spotBody{padding:14px;display:grid;gap:10px;}
.spotTop{display:flex;align-items:center;justify-content:space-between;gap:10px;flex-wrap:wrap;}
.spotBadge{
  display:inline-flex;align-items:center;gap:8px;
  padding:8px 12px;border-radius:999px;
  background: rgba(220,38,38,.10);
  border:1px solid rgba(220,38,38,.22);
  color:#991b1b;
  font-weight:1000;
  letter-spacing:.2px;
}
.spotTitle{margin:0;font-size:16px;font-weight:1000;line-height:1.2;color:var(--text)}
.spotPrices{display:flex;align-items:flex-end;justify-content:space-between;gap:10px;flex-wrap:wrap;}
.priceNow{
  display:inline-flex;align-items:center;gap:8px;
  padding:8px 12px;
  border-radius:999px;
  background: rgba(22,163,74,.12);
  border:1px solid rgba(22,163,74,.22);
  font-weight:1000;
  font-size:20px;
  color:#14532d;
  white-space:nowrap;
}
.priceOld{
  color: rgba(15,23,42,.55);
  font-weight:900;
  font-size:14px;
  text-decoration: line-through;
  white-space:nowrap;
}
.spotCopy{
  font-weight:900;
  color: rgba(15,23,42,.85);
  line-height:1.35;
}
.spotBtns{display:flex;gap:10px;flex-wrap:wrap;}

/* Controls */
.controls{
  margin-top:14px;
  display:flex;gap:10px;flex-wrap:wrap;
  align-items:center;justify-content:space-between;
}
.search{
  flex:1; min-width:240px;
  display:flex;align-items:center;gap:10px;
  padding:12px 12px;
  border:1px solid rgba(15,23,42,.14);
  border-radius:14px;
  background: rgba(255,255,255,.92);
}
.search input{
  width:100%;
  background:transparent;border:none;outline:none;color:var(--text);
  font-size:14px;font-weight:800;
}
.search input::placeholder{color: rgba(71,85,105,.95);}
.select{
  min-width:180px;
  padding:12px 12px;
  border:1px solid rgba(15,23,42,.14);
  border-radius:14px;
  background: rgba(255,255,255,.92);
  color:var(--text);
  font-weight:900;
  outline:none;
}

/* Chips */
.chips{margin-top:10px;display:flex;gap:10px;flex-wrap:wrap;align-items:center;}
.chip{
  display:inline-flex;align-items:center;gap:8px;
  padding:10px 12px;
  border-radius:999px;
  border:1px solid rgba(15,23,42,.14);
  background: rgba(255,255,255,.92);
  color:var(--text);
  font-weight:1000;
  cursor:pointer;
  user-select:none;
  box-shadow: 0 10px 20px rgba(2,6,23,.06);
}
.chipOn{
  border:1px solid rgba(22,163,74,.28);
  background: rgba(22,163,74,.10);
  color:#14532d;
}

/* Social */
.bar{
  margin-top:14px;
  display:grid;
  grid-template-columns: 1fr 1fr;
  gap:10px;
}
@media (max-width: 860px){
  .bar{grid-template-columns:1fr}
}
.notice{
  border:1px solid rgba(15,23,42,.12);
  background: rgba(255,255,255,.92);
  border-radius:14px;
  padding:14px;
  display:flex;gap:10px;align-items:flex-start;
  box-shadow: 0 12px 26px rgba(2,6,23,.06);
}
.badge{
  width:42px;height:42px;border-radius:14px;
  display:flex;align-items:center;justify-content:center;
  background: rgba(245,158,11,.18);
  border:1px solid rgba(245,158,11,.30);
  flex:0 0 auto;
  font-size:18px;
}
.notice h3{margin:0;font-size:16px;font-weight:1000;letter-spacing:.2px;color:var(--text)}
.notice p{margin:6px 0 0;color: var(--text);font-weight:900;font-size:14px;line-height:1.35}

/* Grid / cards */
.grid{
  margin-top:16px;
  display:grid;
  grid-template-columns: repeat(3, 1fr);
  gap:12px;
}
@media (max-width: 980px){.grid{grid-template-columns: repeat(2,1fr)}}
@media (max-width: 620px){.grid{grid-template-columns: repeat(2, 1fr)}}
@media (max-width: 380px){.grid{grid-template-columns: 1fr}}

.card{
  border:1px solid rgba(15,23,42,.12);
  background: linear-gradient(180deg, rgba(255,255,255,.96), rgba(255,255,255,.86));
  border-radius: var(--radius);
  overflow:hidden;
  box-shadow: 0 16px 36px rgba(2,6,23,.10);
  display:flex;flex-direction:column;
  min-height: 440px;
  transform: translateZ(0);
}
.card:hover{
  transform: translateY(-2px);
  box-shadow: 0 20px 46px rgba(2,6,23,.14);
}

.imgbox{
  background:
    radial-gradient(240px 120px at 50% 20%, rgba(255,208,0,.22), transparent 60%),
    rgba(2,6,23,.03);
  border-bottom:1px solid rgba(15,23,42,.10);
  aspect-ratio: 16 / 11;
  display:flex;align-items:center;justify-content:center;
  overflow:hidden;
  padding:10px;
  position:relative;
}
.imgbox img{
  width:100%;height:100%;
  object-fit:contain;
  display:block;
  filter:saturate(1.05) contrast(1.03);
  background: #fff;
  border-radius: 12px;
  border:1px solid rgba(15,23,42,.10);
  box-shadow: 0 10px 22px rgba(2,6,23,.10);
}

.cardBody{padding:12px;display:grid;gap:10px}
.title{
  margin:0;
  font-size:15px;
  line-height:1.22;
  font-weight:1000;
  min-height: 36px;
  color:var(--text);
}

/* CTA por produto ‚Äî AMARELO (somente CTA) */
.ctaTag{
  display:inline-flex;
  align-items:center;
  gap:8px;
  padding:8px 10px;
  border-radius:12px;

  background: linear-gradient(180deg, #ffd000, #ffb800) !important;
  border:1px solid #e6a700 !important;

  color:#1a1400 !important;
  font-weight:1000 !important;
  font-size:13px;
  line-height:1.25;

  box-shadow: 0 6px 16px rgba(0,0,0,.12);
}

.prices{display:flex;align-items:flex-end;justify-content:space-between;gap:10px;flex-wrap:wrap;}
.row{display:flex;justify-content:space-between;gap:10px;align-items:center;flex-wrap:wrap;}
.muted{color:var(--muted);font-weight:900;font-size:12px}

.tag{
  display:inline-flex;align-items:center;gap:6px;
  padding:6px 10px;border-radius:999px;
  border:1px solid rgba(15,23,42,.14);
  background: rgba(255,255,255,.92);
  font-size:12px;font-weight:900;color:var(--text);
}

/* remove tag antiga de desconto */
.tag.off{display:none !important;}

.tag.coupon{
  border:1px solid rgba(22,163,74,.22);
  background: rgba(22,163,74,.10);
  color:#14532d;
}

.buy{margin-top:2px;display:flex;gap:10px;flex-wrap:wrap;}
.btnSmall{
  flex:1;
  min-width: 140px;
  display:flex;align-items:center;justify-content:center;
  padding:11px 12px;border-radius:14px;
  border:1px solid rgba(15,23,42,.14);
  background: rgba(255,255,255,.92);
  font-weight:1000;
  cursor:pointer;
  color:var(--text);
}
.btnBuy{
  background: linear-gradient(135deg, rgba(245,158,11,.98), rgba(245,158,11,.78));
  color:#1b1201;border:none;
}
.btnGroup{
  background: linear-gradient(135deg, rgba(22,163,74,.98), rgba(22,163,74,.78));
  color:#052014;border:none;
}
.btnShare{
  background: rgba(255,255,255,.92);
  border:1px solid rgba(15,23,42,.16);
  color:var(--text);
}

/* Footer */
footer{
  margin:18px 0 110px;
  border:1px solid var(--border);
  background: rgba(255,255,255,.92);
  border-radius: var(--radius);
  padding:14px;
}
footer b{display:block;margin-bottom:6px;color:var(--text)}
footer ul{margin:0;padding-left:18px;color:var(--muted);font-weight:900;font-size:13px;line-height:1.55}

/* WhatsApp floating */
.wa{
  position:fixed;right:16px;bottom:16px;z-index:999;
  display:flex;align-items:center;gap:10px;
  padding:14px 14px;
  border-radius:999px;
  background: linear-gradient(135deg, rgba(22,163,74,.98), rgba(22,163,74,.78));
  color:#052014;
  font-weight:1000;
  box-shadow: 0 18px 40px rgba(0,0,0,.22);
  border:none;
  cursor:pointer;
  max-width: calc(100vw - 32px);
}
.wa small{display:block;font-weight:900;opacity:.9;line-height:1}
.wa span{display:block;line-height:1}
.waIcon{
  width:38px;height:38px;border-radius:999px;
  background: rgba(0,0,0,.12);
  display:flex;align-items:center;justify-content:center;
  font-size:18px;
}

.loading{
  margin-top:16px;
  border:1px dashed rgba(15,23,42,.18);
  border-radius: var(--radius);
  padding:14px;
  color:var(--muted);
  font-weight:900;
  background: rgba(255,255,255,.92);
}

/* ===============================
   ECONOMIA / DESCONTO (VITRINE)
================================ */
.saveBar{
  margin: 10px 0 2px;
  padding: 10px 12px;
  border-radius: 14px;
  display:flex;
  align-items:center;
  justify-content:space-between;
  gap: 10px;
  background: linear-gradient(90deg, rgba(255, 208, 0, .22), rgba(34,197,94,.12));
  border: 1px solid rgba(255, 208, 0, .35);
}
.savePct{
  flex: 0 0 auto;
  font-weight: 1000;
  font-size: 12px;
  padding: 6px 10px;
  border-radius: 999px;
  background: #ff2d2d;
  color: #fff;
  letter-spacing: .3px;
  box-shadow: 0 10px 20px rgba(255,45,45,.18);
}
.saveMoney{
  font-weight: 900;
  font-size: 13px;
  color: #0f172a;
}
.saveMoney b{ font-weight:1000; }

/* Badge de economia na imagem (pequeno, n√£o invasivo) */
.imgBadge{
  position:absolute;
  right:10px;
  bottom:10px;
  z-index:6;
  background:rgba(0,0,0,.55);
  backdrop-filter: blur(4px);
  padding:6px 8px;
  border-radius:10px;
  color:#fff;
  box-shadow:0 10px 25px rgba(0,0,0,.25);
  max-width:72%;
  pointer-events:none;
  display:flex;
  flex-direction:column;
  gap:4px;
}
.imgBadgeOff{
  font-weight:1000;
  font-size:11px;
  padding:4px 7px;
  border-radius:999px;
  background:linear-gradient(90deg,#ff2d55,#ff9500);
  display:inline-block;
  line-height:1;
  color:#fff;
}
.imgBadgeSave{
  font-size:11px;
  font-weight:900;
  line-height:1.15;
  white-space:nowrap;
  color:#fff;
}

@media (max-width:520px){
  header{top:86px}
  .imgBadge{right:8px;bottom:8px;max-width:78%}
  .imgBadgeOff{font-size:10px;padding:4px 6px}
  .imgBadgeSave{font-size:10px}
}
</style>
</head>

<body>

<div class="topbar">
  <div class="wrap">
    <div class="topbrand">
      <div class="toplogo" aria-hidden="true">
        <img src="logo.png" alt="Logo Achadinhos" onerror="this.style.display='none'">
      </div>
    <div class="toptext">
  <div class="topname">Achadinhos Oficial</div>
  <div class="toptag">üöö Tudo com frete gr√°tis ‚Ä¢ at√© <b>70% OFF</b> ‚Äî aproveite antes que acabe</div>
</div>
</div>
      </div>
    </div>

    <div class="topright" onclick="openGroup()" title="Abrir grupo do WhatsApp">
      üü¢ Entrar no grupo
    </div>
  </div>
</div>

<header>
  <div class="wrap">
    <div class="headbar">
      <div class="brand">
        <div class="logo" aria-hidden="true"></div>
        <div>
          <div>Achadinhos <span style="color:#bbf7d0">Oficial</span></div>
          <div class="sub">Ofertas atualizadas direto da planilha</div>
        </div>
      </div>

      <div class="status" title="Atualiza√ß√£o autom√°tica">
        <span class="dot" id="statusDot"></span>
        <span id="updatedLabel"><b>Carregando</b></span>
        <span id="updatedTime" class="mini" data-mode="checking">Verificando‚Ä¶</span>
      </div>

      <div class="pill" id="countPill">0 ofertas</div>
    </div>
  </div>
</header>

<main class="wrap">

  <section class="hero">
    <div class="hero-inner">
      <div>
        <h1>As melhores ofertas do dia ‚Äî sem enrola√ß√£o. <span style="color:#bbf7d0">Clique e garanta.</span></h1>

        <div class="ctaRow">
          <button class="btn btnPrimary" onclick="scrollToOffers()">üéÅ Ver ofertas agora</button>
          <button class="btn" onclick="forceReload()">üîÑ Atualizar agora</button>
          <button class="btn" onclick="openGroup()">üü¢ Entrar no grupo</button>
        </div>

        <div class="videoWrap" id="videoWrap">
          <div class="videoTop">
            <div>
              <b>üé• V√≠deo</b>
              <div class="mini">No celular, autoplay com √°udio √© bloqueado. Use ‚ÄúAtivar √°udio‚Äù.</div>
            </div>
            <button class="btnTiny" onclick="enableVideoAudio()">üîä Ativar √°udio</button>
          </div>
          <div class="videoFrame">
            <video id="promoVideo" controls playsinline preload="metadata"></video>
          </div>
        </div>
      </div>

      <div class="kpi">
        <div class="kpiCard">
          <b id="kpi1">0</b>
          <span>ofertas dispon√≠veis</span>
        </div>
        <div class="kpiCard">
          <b id="kpi2">0</b>
          <span>vendidos hoje (estimativa)</span>
        </div>
      </div>
    </div>
  </section>

  <!-- OFERTA DO MINUTO -->
  <section id="spotlight" class="spot" style="display:none" aria-live="polite">
    <div class="spotImg">
      <img id="spotImg" src="" alt="Oferta do minuto" referrerpolicy="no-referrer">
    </div>
    <div class="spotBody">
      <div class="spotTop">
        <div class="spotBadge">üö® OFERTA DO MINUTO</div>
        <div class="muted" id="spotMeta">pode acabar a qualquer momento</div>
      </div>

      <h2 class="spotTitle" id="spotTitle">‚Äî</h2>

      <div class="spotPrices">
        <div class="priceNow" id="spotNow">‚Äî</div>
        <div class="priceOld" id="spotOld" style="display:none">‚Äî</div>
      </div>

      <div class="spotCopy" id="spotCopy">
        üî• Oferta rotativa: Se gostou, aproveite agora ‚Äî pode acabar a qualquer momento.
      </div>

      <div class="spotBtns">
        <button class="btnSmall btnBuy" onclick="spotOpen()">Ver oferta</button>
        <button class="btnSmall btnGroup" onclick="openGroup()">Entrar no grupo</button>
        <button class="btnSmall btnShare" onclick="spotShare()">Compartilhar</button>
      </div>
    </div>
  </section>

  <section class="controls">
    <div class="search">
      üîé <input id="q" type="text" placeholder="Buscar produto (ex: t√™nis, perfume, mesa...)" />
    </div>

    <select class="select" id="sort">
      <option value="best">Ordenar: destaque</option>
      <option value="priceAsc">Menor pre√ßo</option>
      <option value="priceDesc">Maior pre√ßo</option>
      <option value="discountDesc">Maior desconto</option>
      <option value="soldDesc">Mais vendidos</option>
      <option value="ratingDesc">Melhor avalia√ß√£o</option>
    </select>
  </section>

  <section class="chips">
    <div class="chip" id="chipCoupon" onclick="toggleChip('coupon')">üßæ Com cupom</div>
    <div class="chip" id="chipDiscount" onclick="toggleChip('discount')">üî• Maior desconto</div>
  </section>

  <section class="bar">
    <div class="notice">
      <div class="badge">‚úÖ</div>
      <div>
        <p id="socialProof">‚úÖ +1.200 pessoas j√° entraram no grupo ‚Ä¢ üî• 27 ofertas postadas hoje</p>
      </div>
    </div>

    <div class="notice">
      <div class="badge">üî•</div>
      <div>
        <p id="urgencyText">üî• As melhores ofertas somem primeiro. Se gostou, clique e garanta AGORA ‚Äî pode acabar a qualquer momento.</p>
      </div>
    </div>
  </section>

  <div id="loading" class="loading">Carregando ofertas da planilha‚Ä¶</div>

  <section id="offers" class="grid" aria-live="polite"></section>

  <footer>
    <b>üîí Compra com mais seguran√ßa</b>
    <ul>
      <li>Este site divulga ofertas encontradas em marketplaces e grupos parceiros.</li>
      <li><b>N√£o somos uma loja oficial do Mercado Livre</b> e n√£o representamos a marca.</li>
      <li>Pre√ßos e disponibilidade podem mudar a qualquer momento no site do vendedor.</li>
      <li>Se algum item n√£o abrir, atualize a p√°gina e tente novamente.</li>
    </ul>
  </footer>

</main>

<button class="wa" onclick="openGroup()" aria-label="Entrar no grupo do WhatsApp">
  <div class="waIcon">üü¢</div>
  <div>
    <span>Entrar no grupo</span>
    <small>Receber links e cupons</small>
  </div>
</button>
<script defer>
  // =========================
  // CONFIG
  // =========================
  const SHEET_CSV_URL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vQYh-FJUhtB7MT80tKHccZi-z1hTKUOwDqg-tQSR_YPiDOQv-mKmSjTyAtZzmhq8YEchYOjqcVZhJv3/pub?output=csv";
  const WHATSAPP_GROUP_LINK = "https://chat.whatsapp.com/GdvrM4Ct4Q6CA6Tf0DRyov";
  const VIDEO_URL = "video.mp4";

  const REFRESH_MS = 20 * 1000;     // 20s
  const SPOT_ROTATE_MS = 25 * 1000; // 25s

  const DEFAULT_GROUP_COUNT = 1200;
  const DEFAULT_POSTS_TODAY = 27;

  // Escassez por expira√ß√£o
  const URGENCY_SOON_HOURS = 6;
  const URGENCY_TODAY_HOURS = 24;

  // =========================
  // STATE
  // =========================
  let ALL_ITEMS = [];
  let FILTER_COUPON_ONLY = false;
  let FILTER_TOP_DISCOUNT = false;

  let SPOT_ITEM = null;
  let SPOT_TOP_LIST = [];
  let SPOT_INDEX = 0;

  let SPOT_TIMER = null;
  let SHEET_TIMER = null;
  let LAST_SPOT_TICK = 0;

  // =========================
  // HELPERS
  // =========================
  function nowHHMMSS(){
    const d = new Date();
    const hh = String(d.getHours()).padStart(2,'0');
    const mm = String(d.getMinutes()).padStart(2,'0');
    const ss = String(d.getSeconds()).padStart(2,'0');
    return `${hh}:${mm}:${ss}`;
  }

  function moneyBRLFromNumber(n){
    if (!isFinite(n)) return "";
    return n.toLocaleString("pt-BR", { style:"currency", currency:"BRL" });
  }

  function toNumber(str){
    if (str == null) return NaN;
    const s = String(str).trim()
      .replace(/\s/g,'')
      .replace(/\./g,'')
      .replace(',', '.')
      .replace(/[^\d.-]/g,'');
    const n = Number(s);
    return isFinite(n) ? n : NaN;
  }

  function safeText(x){
    return (x ?? "").toString().replace(/\s+/g,' ').trim();
  }

  function escapeHtml(s){
    return (s ?? "").toString()
      .replaceAll("&","&amp;")
      .replaceAll("<","&lt;")
      .replaceAll(">","&gt;")
      .replaceAll('"',"&quot;");
  }

  function scrollToOffers(){
    document.getElementById("offers")?.scrollIntoView({behavior:"smooth", block:"start"});
  }

  function openGroup(){
    window.open(WHATSAPP_GROUP_LINK, "_blank");
  }

  // =========================
  // DATA / EXPIRES / CREATED_AT
  // =========================
  function parseDateFlex(s, defaultHour, defaultMinute){
    const raw = safeText(s);
    if(!raw) return null;

    let m = raw.match(/^(\d{4})-(\d{2})-(\d{2})(?:[ T](\d{2}):(\d{2})(?::(\d{2}))?)?$/);
    if(m){
      const Y = Number(m[1]);
      const Mo = Number(m[2]) - 1;
      const D = Number(m[3]);
      const hh = m[4] != null ? Number(m[4]) : defaultHour;
      const mm = m[5] != null ? Number(m[5]) : defaultMinute;
      const ss = m[6] != null ? Number(m[6]) : 0;
      const dt = new Date(Y, Mo, D, hh, mm, ss);
      return isNaN(dt.getTime()) ? null : dt;
    }

    m = raw.match(/^(\d{2})\/(\d{2})\/(\d{4})(?:[ T](\d{2}):(\d{2})(?::(\d{2}))?)?$/);
    if(m){
      const D = Number(m[1]);
      const Mo = Number(m[2]) - 1;
      const Y = Number(m[3]);
      const hh = m[4] != null ? Number(m[4]) : defaultHour;
      const mm = m[5] != null ? Number(m[5]) : defaultMinute;
      const ss = m[6] != null ? Number(m[6]) : 0;
      const dt = new Date(Y, Mo, D, hh, mm, ss);
      return isNaN(dt.getTime()) ? null : dt;
    }

    return null;
  }

  function parseExpires(s){ return parseDateFlex(s, 23, 59); }
  function parseCreatedAt(s){ return parseDateFlex(s, 0, 0); }

  function isExpired(expiresText){
    const dt = parseExpires(expiresText);
    if(!dt) return false;
    return dt.getTime() < Date.now();
  }

  function diffToHuman(expiresText){
    const dt = parseExpires(expiresText);
    if(!dt) return "";

    const ms = dt.getTime() - Date.now();
    if(ms <= 0) return "‚ö†Ô∏è expirada";

    const minutes = Math.floor(ms / 60000);
    const hours = Math.floor(minutes / 60);
    const days = Math.floor(hours / 24);

    if(hours < 1) return `‚è∞ expira em ${Math.max(1, minutes)} min`;
    if(hours < URGENCY_SOON_HOURS) return `‚è∞ expira em ${hours}h`;
    if(hours < URGENCY_TODAY_HOURS) return `‚ö†Ô∏è expira hoje`;
    if(days === 1) return `üìÖ expira amanh√£`;
    return `üìÖ expira em ${days} dias`;
  }

  // =========================
  // BADGE AUTO
  // =========================
  function pickAutoBadge(title, link){
    const hay = (`${safeText(title)} ${safeText(link)}`).toLowerCase();
    if(hay.includes("full")) return "FULL";
    if(hay.includes("prime")) return "Prime";
    if(hay.includes("frete gr√°tis") || hay.includes("frete gratis") || hay.includes("fretegratis") || hay.includes("free shipping")) return "Frete Gr√°tis";
    if(hay.includes("rel√¢mpago") || hay.includes("relampago") || hay.includes("lightning") || hay.includes("flash")) return "Rel√¢mpago";
    if(hay.includes("cupom") || hay.includes("coupon")) return "Cupom";
    if(hay.includes("promo") || hay.includes("oferta") || hay.includes("desconto")) return "Promo";
    return "";
  }

  // =========================
  // STATUS
  // =========================
  function setStatus(mode, text){
    const dot = document.getElementById("statusDot");
    const label = document.getElementById("updatedLabel");
    const time = document.getElementById("updatedTime");
    if(!dot || !label || !time) return;

    if (mode === "ok"){
      dot.style.background = "var(--brand)";
      dot.style.boxShadow = "0 0 0 4px rgba(34,197,94,.12)";
      label.innerHTML = "<b>Atualizado</b>";
      time.dataset.mode = "updated";
      time.textContent = text;
    } else if (mode === "loading"){
      dot.style.background = "var(--accent)";
      dot.style.boxShadow = "0 0 0 4px rgba(245,158,11,.12)";
      label.innerHTML = "<b>Carregando</b>";
      time.dataset.mode = "checking";
      time.textContent = text;
    } else {
      dot.style.background = "var(--danger)";
      dot.style.boxShadow = "0 0 0 4px rgba(239,68,68,.12)";
      label.innerHTML = "<b>Falha</b>";
      time.dataset.mode = "checking";
      time.textContent = text;
    }
  }

  function startLiveClock(){
    const timeEl = document.getElementById("updatedTime");
    if(!timeEl) return;
    setInterval(() => {
      if(timeEl.dataset.mode !== "updated"){
        timeEl.textContent = `Verificando: ${nowHHMMSS()}`;
      }
    }, 1000);
  }

  function parseCSV(text){
    const rows = [];
    let row = [];
    let cur = "";
    let inQuotes = false;

    for(let i=0;i<text.length;i++){
      const ch = text[i];
      const next = text[i+1];
      if(ch === '"' && inQuotes && next === '"'){ cur += '"'; i++; continue; }
      if(ch === '"'){ inQuotes = !inQuotes; continue; }
      if(ch === ',' && !inQuotes){ row.push(cur); cur = ""; continue; }
      if((ch === '\n' || ch === '\r') && !inQuotes){
        if(ch === '\r' && next === '\n'){ i++; }
        row.push(cur); cur = "";
        if(row.length > 1 || row[0].trim() !== "") rows.push(row);
        row = [];
        continue;
      }
      cur += ch;
    }
    row.push(cur);
    if(row.length > 1 || row[0].trim() !== "") rows.push(row);
    return rows;
  }

  // =========================
  // VIDEO
  // =========================
  function setupVideo(){
    const vid = document.getElementById("promoVideo");
    if(!vid) return;
    vid.src = VIDEO_URL;
    vid.muted = true;
    vid.playsInline = true;
    vid.autoplay = true;
    vid.play().catch(()=>{});
  }

  function enableVideoAudio(){
    const vid = document.getElementById("promoVideo");
    if(!vid) return;
    vid.muted = false;
    vid.volume = 1;
    vid.play().catch(()=>{});
  }

  // =========================
  // CHIPS
  // =========================
  function toggleChip(which){
    if(which === "coupon"){
      FILTER_COUPON_ONLY = !FILTER_COUPON_ONLY;
      document.getElementById("chipCoupon")?.classList.toggle("chipOn", FILTER_COUPON_ONLY);
    }
    if(which === "discount"){
      FILTER_TOP_DISCOUNT = !FILTER_TOP_DISCOUNT;
      document.getElementById("chipDiscount")?.classList.toggle("chipOn", FILTER_TOP_DISCOUNT);
    }
    render();
  }

  // =========================
  // SORT / FILTER
  // =========================
  function forceReload(){ loadSheet(true); }

  function getQuery(){
    return safeText(document.getElementById("q")?.value).toLowerCase();
  }

  function getSort(){
    return document.getElementById("sort")?.value || "best";
  }

  function filterItems(items){
    const q = getQuery();
    let out = items;

    if(q){
      out = out.filter(it => (`${it.title} ${it.coupon||""} ${it.badge||""} ${it.cta||""}`.toLowerCase()).includes(q));
    }
    if(FILTER_COUPON_ONLY){
      out = out.filter(it => !!safeText(it.coupon));
    }
    if(FILTER_TOP_DISCOUNT){
      const sorted = [...out].sort((a,b)=>(b.discountNum||0)-(a.discountNum||0));
      const keep = Math.max(10, Math.ceil(sorted.length * 0.20));
      out = sorted.slice(0, keep);
    }
    return out;
  }

  function compareNewest(a, b){
    const ca = (a.createdAtMs && a.createdAtMs > 0) ? a.createdAtMs : 0;
    const cb = (b.createdAtMs && b.createdAtMs > 0) ? b.createdAtMs : 0;
    if(cb !== ca) return cb - ca;
    const ra = (a.rowIndex ?? 0);
    const rb = (b.rowIndex ?? 0);
    return rb - ra;
  }

  function sortItems(items, mode){
    const a = [...items];

    if(mode === "priceAsc"){
      a.sort((x,y)=>{
        const r = (x.finalPriceNum||Infinity) - (y.finalPriceNum||Infinity);
        return r !== 0 ? r : compareNewest(x,y);
      });
    } else if(mode === "priceDesc"){
      a.sort((x,y)=>{
        const r = (y.finalPriceNum||-Infinity) - (x.finalPriceNum||-Infinity);
        return r !== 0 ? r : compareNewest(x,y);
      });
    } else if(mode === "discountDesc"){
      a.sort((x,y)=>{
        const r = (y.discountNum||0) - (x.discountNum||0);
        return r !== 0 ? r : compareNewest(x,y);
      });
    } else if(mode === "soldDesc"){
      a.sort((x,y)=>{
        const r = (y.soldNum||0) - (x.soldNum||0);
        return r !== 0 ? r : compareNewest(x,y);
      });
    } else if(mode === "ratingDesc"){
      a.sort((x,y)=>{
        const r = (y.ratingNum||0) - (x.ratingNum||0);
        return r !== 0 ? r : compareNewest(x,y);
      });
    } else {
      a.sort((x,y)=>{
        const newest = compareNewest(x,y);
        if(newest !== 0) return newest;

        const sx = (x.soldNum||0)*2 + (x.discountNum||0)*1.2 + (x.ratingNum||0)*10;
        const sy = (y.soldNum||0)*2 + (y.discountNum||0)*1.2 + (y.ratingNum||0)*10;
        const r = sy - sx;
        return r !== 0 ? r : 0;
      });
    }
    return a;
  }

  function openOffer(it){
    const u = safeText(it.link);
    window.open(u || WHATSAPP_GROUP_LINK, "_blank");
  }

  async function shareOffer(it){
    const title = safeText(it.title) || "Oferta";
    const url = safeText(it.link) || WHATSAPP_GROUP_LINK;
    const text = `üî• OFERTA: ${title}\nüëâ Link: ${url}\n\nEntre no grupo: ${WHATSAPP_GROUP_LINK}`;
    try{
      if(navigator.share){
        await navigator.share({ title: "Achadinhos Oficial", text, url });
        return;
      }
    }catch(_){}
    try{
      await navigator.clipboard.writeText(text);
      alert("Copiado! Agora √© s√≥ colar no WhatsApp/Instagram.");
    }catch{
      prompt("Copie e compartilhe:", text);
    }
  }

  async function copyCouponAndOpenWhatsApp(it){
    const c = safeText(it.coupon);
    const title = safeText(it.title) || "Oferta";
    if(!c){ alert("Este item n√£o tem cupom."); return; }

    const msg =
`üî• CUPOM + OFERTA
Produto: ${title}
Cupom: ${c}

üëâ Quero o link dessa oferta (se tiver) e instru√ß√µes pra usar o cupom.
Grupo: ${WHATSAPP_GROUP_LINK}`;

    try{ await navigator.clipboard.writeText(c); }catch(_){}
    window.open(`https://wa.me/?text=${encodeURIComponent(msg)}`, "_blank");
  }

  // =========================
  // ‚úÖ OFERTA DO MINUTO
  // =========================
  function buildSpotTopList(items){
    if(!items.length) return [];
    const scored = [...items].sort((a,b)=>{
      const sa = (a.discountNum||0)*1.3 + (a.ratingNum||0)*10 + (a.soldNum||0)*0.02;
      const sb = (b.discountNum||0)*1.3 + (b.ratingNum||0)*10 + (b.soldNum||0)*0.02;
      return sb - sa;
    });
    return scored.slice(0, Math.min(12, scored.length));
  }

  function setSpotItem(it){
    SPOT_ITEM = it || null;
    renderSpotlight();
  }

  function renderSpotlight(){
    const box = document.getElementById("spotlight");
    if(!box) return;

    if(!SPOT_ITEM){
      box.style.display = "none";
      return;
    }

    document.getElementById("spotImg").src = SPOT_ITEM.image || "";
    document.getElementById("spotTitle").textContent = SPOT_ITEM.title || "Oferta";
    document.getElementById("spotNow").textContent = SPOT_ITEM.finalPriceText || "‚Äî";

    const old = document.getElementById("spotOld");
    if(old){
      if(SPOT_ITEM.originalPriceText && SPOT_ITEM.originalPriceText !== SPOT_ITEM.finalPriceText){
        old.style.display = "block";
        old.textContent = SPOT_ITEM.originalPriceText;
      } else {
        old.style.display = "none";
      }
    }

    const metaBits = [];
    if(SPOT_ITEM.badge) metaBits.push(`üè∑Ô∏è ${SPOT_ITEM.badge}`);
    if(SPOT_ITEM.urgency) metaBits.push(`${SPOT_ITEM.urgency}`);
    if(SPOT_ITEM.rating) metaBits.push(`‚≠ê ${SPOT_ITEM.rating}`);
    if(SPOT_ITEM.sold) metaBits.push(`‚úÖ ${SPOT_ITEM.sold} vendidos`);
    if(SPOT_ITEM.saveText) metaBits.push(`üí∞ economize ${SPOT_ITEM.saveText}`);

    document.getElementById("spotMeta").textContent = metaBits.length ? metaBits.join(" ‚Ä¢ ") : "pode acabar a qualquer momento";
    box.style.display = "grid";
  }

  function spotNext(){
    if(!SPOT_TOP_LIST.length){
      setSpotItem(null);
      return;
    }
    SPOT_INDEX = (SPOT_INDEX + 1) % SPOT_TOP_LIST.length;
    setSpotItem(SPOT_TOP_LIST[SPOT_INDEX]);
    LAST_SPOT_TICK = Date.now();
  }

  function startSpotRotation(){
    if(SPOT_TIMER) return;
    if(!SPOT_TOP_LIST.length){
      setSpotItem(null);
      return;
    }
    if(!SPOT_ITEM){
      SPOT_INDEX = 0;
      setSpotItem(SPOT_TOP_LIST[SPOT_INDEX]);
      LAST_SPOT_TICK = Date.now();
    }
    SPOT_TIMER = setInterval(() => {
      spotNext();
    }, SPOT_ROTATE_MS);
  }

  function updateSpotListFromSheet(){
    const newList = buildSpotTopList(ALL_ITEMS);
    if(!newList.length){
      SPOT_TOP_LIST = [];
      SPOT_INDEX = 0;
      setSpotItem(null);
      return;
    }

    const currentKey = SPOT_ITEM ? `${SPOT_ITEM.title}||${SPOT_ITEM.image}||${SPOT_ITEM.finalPriceText}` : "";
    SPOT_TOP_LIST = newList;

    let keepIndex = -1;
    if(currentKey){
      keepIndex = SPOT_TOP_LIST.findIndex(x => `${x.title}||${x.image}||${x.finalPriceText}` === currentKey);
    }

    if(keepIndex >= 0){
      SPOT_INDEX = keepIndex;
      setSpotItem(SPOT_TOP_LIST[SPOT_INDEX]);
    } else {
      SPOT_INDEX = 0;
      setSpotItem(SPOT_TOP_LIST[SPOT_INDEX]);
      LAST_SPOT_TICK = Date.now();
    }
  }

  function spotOpen(){
    if(!SPOT_ITEM) return;
    openOffer(SPOT_ITEM);
  }

  function spotShare(){
    if(!SPOT_ITEM) return;
    shareOffer(SPOT_ITEM);
  }

  // =========================
  // MAIN RENDER
  // =========================
  function render(){
    const grid = document.getElementById("offers");
    const loading = document.getElementById("loading");
    if(!grid || !loading) return;

    const filtered = filterItems(ALL_ITEMS);
    const sorted = sortItems(filtered, getSort());

    grid.innerHTML = "";
    loading.style.display = sorted.length ? "none" : "block";
    loading.textContent = sorted.length ? "" : "Nenhuma oferta encontrada. Tente outra busca.";

    const countPill = document.getElementById("countPill");
    if(countPill) countPill.textContent = `${ALL_ITEMS.length} ofertas`;

    for(const it of sorted){
      const card = document.createElement("article");
      card.className = "card";

      const img = document.createElement("div");
      img.className = "imgbox";
      img.style.position = "relative";
      img.innerHTML = `<img src="${it.image || ""}" alt="${escapeHtml(it.title)}" loading="lazy" referrerpolicy="no-referrer" />`;

      // ‚úÖ selo pequeno -% (n√£o tampa a imagem)
      if(it.pctNum && it.pctNum > 0){
        const b = document.createElement("div");
        b.className = "imgBadgeMini";
        b.textContent = `-${it.pctNum}%`;
        img.appendChild(b);
      }

      card.appendChild(img);

      const body = document.createElement("div");
      body.className = "cardBody";

      const title = document.createElement("h2");
      title.className = "title";
      title.textContent = it.title || "Oferta";
      body.appendChild(title);

      if(it.cta){
        const cta = document.createElement("div");
        cta.className = "ctaTag";
        cta.textContent = it.cta;
        body.appendChild(cta);
      }

      const prices = document.createElement("div");
      prices.className = "prices";

      const nowP = document.createElement("div");
      nowP.className = "priceNow";
      nowP.textContent = it.finalPriceText || "‚Äî";
      prices.appendChild(nowP);

      if(it.originalPriceText && it.originalPriceText !== it.finalPriceText){
        const oldP = document.createElement("div");
        oldP.className = "priceOld";
        oldP.textContent = it.originalPriceText;
        prices.appendChild(oldP);
      }

      body.appendChild(prices);

      // ‚úÖ ECONOMIA + % OFF (bem claro)
      if(it.saveNum && it.saveNum > 0 && it.pctNum && it.pctNum > 0){
        const saveBar = document.createElement("div");
        saveBar.className = "saveBar";
        saveBar.innerHTML = `
          <span class="savePct">${escapeHtml(it.pctText || "")}</span>
          <span class="saveMoney">Voc√™ economiza <b>${escapeHtml(it.saveText || "")}</b></span>
        `;
        body.appendChild(saveBar);
      }

      const row1 = document.createElement("div");
      row1.className = "row";

      const left = document.createElement("div");
      left.className = "muted";
      left.textContent = `${it.rating ? `‚≠ê ${it.rating}` : "‚≠ê ‚Äî"} ‚Ä¢ ${it.sold ? `${it.sold} vendidos` : "‚Äî vendidos"}`;
      row1.appendChild(left);

      const right = document.createElement("div");
      right.style.display="flex";
      right.style.gap="8px";
      right.style.flexWrap="wrap";
      right.style.justifyContent="flex-end";

      if(it.badge){
        const t = document.createElement("span");
        t.className = "tag";
        t.style.border = "1px solid rgba(59,130,246,.32)";
        t.style.background = "rgba(59,130,246,.12)";
        t.style.color = "#bfdbfe";
        t.textContent = it.badge;
        right.appendChild(t);
      }

      if(it.urgency){
        const t = document.createElement("span");
        t.className = "tag";
        t.style.border = "1px solid rgba(245,158,11,.30)";
        t.style.background = "rgba(245,158,11,.14)";
        t.style.color = "#fde68a";
        t.textContent = it.urgency;
        right.appendChild(t);
      }

      // ‚ùå REMOVIDO: tag amarelo/‚Äúoff‚Äù
      // if(it.discount){ ... }

      if(it.coupon){
        const t = document.createElement("span");
        t.className = "tag coupon";
        t.textContent = `CUPOM: ${it.coupon}`;
        right.appendChild(t);
      }

      row1.appendChild(right);
      body.appendChild(row1);

      const buy = document.createElement("div");
      buy.className = "buy";

      const btn1 = document.createElement("button");
      btn1.className = "btnSmall btnBuy";
      btn1.textContent = "Ver oferta";
      btn1.onclick = () => openOffer(it);
      buy.appendChild(btn1);

      const btn2 = document.createElement("button");
      btn2.className = "btnSmall btnGroup";
      btn2.textContent = "Entrar no grupo";
      btn2.onclick = () => openGroup();
      buy.appendChild(btn2);

      const btn3 = document.createElement("button");
      btn3.className = "btnSmall btnShare";
      btn3.textContent = "Compartilhar";
      btn3.onclick = () => shareOffer(it);
      buy.appendChild(btn3);

      const btn4 = document.createElement("button");
      btn4.className = "btnSmall";
      btn4.textContent = "Copiar cupom";
      btn4.onclick = () => copyCouponAndOpenWhatsApp(it);
      buy.appendChild(btn4);

      body.appendChild(buy);
      card.appendChild(body);
      grid.appendChild(card);
    }
  }

  // =========================
  // LOAD SHEET
  // =========================
  async function loadSheet(isManual=false){
    try{
      setStatus("loading", (isManual ? "Atualizando agora‚Ä¶ " : "Atualizando‚Ä¶ ") + nowHHMMSS());
      const url = SHEET_CSV_URL + (SHEET_CSV_URL.includes("?") ? "&" : "?") + "t=" + Date.now();
      const res = await fetch(url, { cache:"no-store" });
      if(!res.ok) throw new Error("HTTP " + res.status);

      const text = await res.text();
      const rows = parseCSV(text);
      if(!rows.length) throw new Error("CSV vazio");

      const header = rows[0].map(h => safeText(h).toLowerCase());
      const idx = (name) => header.indexOf(name);

      const iImage = idx("image");
      const iTitle = idx("title");
      const iPrice = idx("price");
      const iDiscount = idx("discount");
      const iCoupon = idx("coupon");
      const iSold = idx("sold");
      const iRating = idx("rating");
      const iLink =
        idx("affiliate") >= 0 ? idx("affiliate") :
        (idx("link") >= 0 ? idx("link") :
        (idx("url") >= 0 ? idx("url") : -1));

      const iActive = idx("active");
      const iExpires = idx("expires");
      const iBadge = idx("badge");
      const iCreated = idx("created_at");
      const iCta = idx("cta");

      const iGroup = idx("group_count");
      const iPosts = idx("posts_today");

      let groupCount = null;
      let postsToday = null;

      const items = [];
      for(let r=1; r<rows.length; r++){
        const row = rows[r] || [];

        if(groupCount == null && iGroup >= 0){
          const g = toNumber(row[iGroup]);
          if(isFinite(g) && g > 0) groupCount = Math.round(g);
        }
        if(postsToday == null && iPosts >= 0){
          const p = toNumber(row[iPosts]);
          if(isFinite(p) && p > 0) postsToday = Math.round(p);
        }

        const title = safeText(row[iTitle]);
        const image = safeText(row[iImage]);
        const originalRaw = safeText(row[iPrice]);
        const discountRaw = safeText(row[iDiscount]);
        const coupon = safeText(row[iCoupon]);
        const sold = safeText(row[iSold]);
        const rating = safeText(row[iRating]);
        const link = iLink >= 0 ? safeText(row[iLink]) : "";
        const cta = iCta >= 0 ? safeText(row[iCta]) : "";

        const activeRaw = iActive >= 0 ? safeText(row[iActive]).toLowerCase() : "";
        const isActive = !(activeRaw === "0" || activeRaw === "false" || activeRaw === "nao" || activeRaw === "n√£o");
        if(!isActive) continue;

        const expiresRaw = iExpires >= 0 ? safeText(row[iExpires]) : "";
        if(expiresRaw && isExpired(expiresRaw)) continue;

        const badgeManual = iBadge >= 0 ? safeText(row[iBadge]) : "";
        const badgeAuto = badgeManual ? "" : pickAutoBadge(title, link);
        const badge = badgeManual || badgeAuto;

        const urgency = expiresRaw ? diffToHuman(expiresRaw) : "";

        const createdRaw = iCreated >= 0 ? safeText(row[iCreated]) : "";
        const createdDt = createdRaw ? parseCreatedAt(createdRaw) : null;
        const createdAtMs = createdDt ? createdDt.getTime() : 0;

        if(!title && !image && !originalRaw && !link) continue;

        const originalNum = toNumber(originalRaw);

        let discountNum = toNumber(discountRaw);
        if(!isFinite(discountNum)){
          const m = (discountRaw || "").match(/(\d+(?:[.,]\d+)?)/);
          discountNum = m ? toNumber(m[1]) : 0;
        }
        if(!isFinite(discountNum)) discountNum = 0;

        let finalNum = originalNum;
        if(isFinite(originalNum) && discountNum > 0 && discountNum < 100){
          finalNum = +(originalNum * (1 - discountNum/100)).toFixed(2);
        }

        // ‚úÖ ECONOMIA + % OFF (calculado)
        let saveNum = (isFinite(originalNum) && isFinite(finalNum)) ? +(originalNum - finalNum).toFixed(2) : NaN;

        let pctNum = discountNum;
        if((!isFinite(pctNum) || pctNum <= 0) && isFinite(originalNum) && isFinite(finalNum) && originalNum > 0){
          pctNum = Math.round(((originalNum - finalNum) / originalNum) * 100);
        }
        if(!isFinite(pctNum) || pctNum < 0) pctNum = 0;

        const soldNum = toNumber(sold);
        const ratingNum = toNumber(rating);

        items.push({
          title: title || "Oferta",
          image,
          originalPriceText: isFinite(originalNum) ? moneyBRLFromNumber(originalNum) : (originalRaw || ""),
          originalPriceNum: isFinite(originalNum) ? originalNum : NaN,
          finalPriceText: isFinite(finalNum) ? moneyBRLFromNumber(finalNum) : (originalRaw || ""),
          finalPriceNum: isFinite(finalNum) ? finalNum : NaN,

          // ‚úÖ novos campos
          saveNum,
          saveText: isFinite(saveNum) ? moneyBRLFromNumber(saveNum) : "",
          pctNum,
          pctText: (pctNum && pctNum > 0) ? `${pctNum}% OFF` : "",

          discount: discountRaw,
          discountNum: isFinite(discountNum) ? discountNum : 0,
          coupon,
          sold,
          soldNum: isFinite(soldNum) ? soldNum : 0,
          rating,
          ratingNum: isFinite(ratingNum) ? ratingNum : 0,
          link,
          badge,
          urgency,
          expires: expiresRaw,
          cta,
          created_at: createdRaw,
          createdAtMs,
          rowIndex: r
        });
      }

      ALL_ITEMS = items;

      // KPIs
      const kpi1 = document.getElementById("kpi1");
      const kpi2 = document.getElementById("kpi2");
      if(kpi1) kpi1.textContent = items.length.toString();

      const soldTodaySum = items.reduce((acc,it)=> acc + (it.soldNum||0), 0);
      if(kpi2) kpi2.textContent = soldTodaySum ? soldTodaySum.toString() : "‚Äî";

      // Prova social
      const gc = groupCount ?? DEFAULT_GROUP_COUNT;
      const pt = postsToday ?? DEFAULT_POSTS_TODAY;
      const sp = document.getElementById("socialProof");
      if(sp){
        sp.textContent = `‚úÖ +${gc.toLocaleString("pt-BR")} pessoas j√° entraram no grupo ‚Ä¢ üî• ${pt} ofertas postadas hoje`;
      }

      updateSpotListFromSheet();
      startSpotRotation();

      setStatus("ok", `√öltima atualiza√ß√£o: ${nowHHMMSS()} ‚Ä¢ ${items.length} ofertas`);
      render();

    }catch(err){
      console.error(err);
      setStatus("error", `Tentando novamente‚Ä¶ ${nowHHMMSS()}`);
      const loading = document.getElementById("loading");
      if(loading){
        loading.style.display = "block";
        loading.textContent = "N√£o consegui carregar a planilha agora. Verifique se ela est√° publicada e tente atualizar.";
      }
    }
  }

  // =========================
  // TIMERS
  // =========================
  function startSheetRefresh(){
    if(SHEET_TIMER) clearInterval(SHEET_TIMER);
    SHEET_TIMER = setInterval(() => loadSheet(false), REFRESH_MS);
  }

  document.addEventListener("visibilitychange", () => {
    if(!document.hidden){
      if(!SPOT_TIMER) startSpotRotation();
      if(Date.now() - LAST_SPOT_TICK > (SPOT_ROTATE_MS + 2000)){
        spotNext();
      }
      loadSheet(false);
    }
  });

  // =========================
  // START
  // =========================
  document.getElementById("q")?.addEventListener("input", () => render());
  document.getElementById("sort")?.addEventListener("change", () => render());

  startLiveClock();
  setupVideo();
  loadSheet(true);
  startSheetRefresh();
</script>
<body>  

</html>

